sudo: required
language: javascript
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_8c848010c37a_key -iv $encrypted_8c848010c37a_iv
  -in deploy_key.enc -out deploy_key -d
- docker login --username=$DOCKER_HUB_USERNAME --password=$DOCKER_HUB_PASSWORD
- docker build -t blog-backend .
script:
- docker tag blog-backend:latest $DOCKER_HUB_USERNAME/blog-backend:production
- docker push $DOCKER_HUB_USERNAME/blog-backend:production
after_script: 
deploy:
  provider: script
  skip_cleanup: true
  script: chmod 600 deploy_key && ssh -p $SERVER_PORT -o StrictHostKeyChecking=no
    -i ./deploy_key $SERVER_USERNAME@$SERVER './deploy-script/backend/deploy.sh'
  on:
    branch: master
env:
  global:
  - secure: rFigAbKK2TOB3XzM2NudtoAT3gH/csc7d+LA87H58EydZk2IONumO0AhT3nR5vuLuyv7V9MNcsPlc7cBhTQ85EaXyqn6rx8z/r0FZWHGJZnl4pO8Rhfcqm6IKS6Ht7Ig81dvbdNT7EhmhiqHG2SvvsVZjulGl26lq7smjxp7f5qo5y+wwXi+rFYErosZfTGhUhQ16P81TmW2u1+MgUPWRoOvb898BkBOmbWyw5zQJJzoUS2RD0jFTUgP2Sff47z/sAsOBJyLUhN4/zrbnVVtY0pyeUMbpkh2hXuV6oK7CwTr0LbEAhqgz/k4J1v3XjnTgFY7lfcuMdMVXIkTNdOswYCvZWVhug/dXOFgG7iWYI5XfWSznKmTgpdvmWZMCHCPMI/PhPNyTzlLsKRa7v/N8Eela0DlDC3J2cHC+bDwAMVk2984UnKEtaaD6b6CZoWHlQ4lO3ii1HSZgXNziDBfDjoNIX8ebg4idXDXqcUiR0PKkaZmC3cyYs5I3BjE4eQT8GSPHsQkciOT0AADPz1RM0+PRsnFG+CX08q/O7jXcZmgXxKG1yvItMfS7seRnXSzWqXYMKnH3TP8mfOZ4V4vigquIn5gp+Wt/AYRPemxzEw1fOwk7F7tqEo42UbgDKIBZJ+VVggkUBLL2MIg92vmR2t4fSjm0yM6Imb6wco0X+4=
  - secure: AQRGPWGBMAq5KXB6flUaDGiAxufhqP/bHQlLrjAwl8q9DPpFtXarQysEXG1W8gtQh3XhRvgmaPggPIsoK6R4IDfKym+pYfOnI5SxxT8SP+wOM7Ull7rS4nLSMGXFVdmWdmuttKdC3JyYs2uogc2UUZVHJtcEEzs1bo7xl1dlk5Wt0yU8qb942Ylx4k3y27wX5zMrMyuscr3UkA3j2kUr/6CCxTx4nQKxxAmXMxs0sdcNUeNHDK6IJRW/ySgGmTEgvAx8x249Ysxx2Lqi40q7zs8GetiwR96J45QDAZSE8RH6M9UsYeWll7bahXMNXv0ygS/1nxi1pvaOQLsna4iWIY4qGS5IvEr575WrBO+6IqEAOK1SYKvbKDFQ2cZb5At7pt+lNVXU1/jWXbXRJXBRGQrhboCb6vcbUkUDO9bPIFVAAS8McGa1pGetFI6pvdjkBEwk+lT1UoC0Kx2a8L4rTCudoT1ffRr/9sbUZPkQydwmtsuvQ7fLLIg5Bm11YorOwPlJgkQyzSh2WO9/H10iQfIlUcFH8/nGEaV+prkDreR/GCFkdJmUrTRlsWNWo88+Lqb2ppoIenATVihCaObMVHHq6U2e4cyv9hdcpP4wo0EdPpBfnK18BFQ8iS1ks/LRm5dTGVP/h1tYx2SkKsVw49fI5LIJd05xlTIvNMnrNj4=
  - secure: SQtdcWHWQkOi36dvLwGGuDEazqYyLtVv02fr0v4Ub9/3sFEh1TlEZ4r2HF7AcX9h0Ab/nFgiU+e635Q2FLt3OPsBvm3OcysWnr6Tyv3nh0YDthVCKOWg/6R5N2Vkli9Max9GOg9jwwvaTvrbyg4qF3Mvd1lLp8mbYfIEj/wi+1eVtFRRkLgzd1Zj1Ev8KF/60p4jWW6WKejg8DbXLWwS97bBB7OPjC5Huh/n7fE+S7lgvHzYjR8rOQQjxP+dwLKqFbTtyTDPJjJU9KmnstisjWsNqveDAwPFnPX6AlrUnMovPgUQz4PRcGGrG1cqaUuzIvoQEH80fkgJM0TSwf+jSl1F82IUUtYdSpdTs1Gjv3Gfzt+C34qh3hfWmB4+0Hyislv0eFFo6xcuAaxkY2yRYggnDdkZMIcYcWnHaXk/lbyboM9V5+x7HrIMNc7G+FQ9wQLocZ4zA56ZaZtLsUqYmR7sihUW01qOhI/pa29Y0Yxnm0gD2IHzfWWjLWhWYmHCqKp4D8Juq9b4FwXAA46k6PcFhNs3VDKU2HcbqxtQ1mtCgxX+CJb/wfRiX1PriF1+2wiQ7CW43J1gvKY0YH1wdKFpkC3kXtv9Xb9OTNCt00QqbJp4/0JJJ0oDzzweIKNs/XL8QJ2O6HFFN40bQC23tikb7wYyvYmTuYTmyMxhf04=
  - secure: yVN3OslUMcKUAIO6rG2tYkl901lkDmilc1a34rkqbUjspO2/UA0mcEy5IeMPStn97jeQk2i8ijwDNddBlQsyeru1/5AdpD/6Qna1xMvcvd9WR8LL0nKvWwIj8/1eNKJKxL/QtTiWtcJt8h/HjlLEFwZ3Z9S9kupFipPWAyITEEKZWZruUV7O3JnUGWMuiyrPRFqFdflXRkW457FrmG7+ubUZ8HEzYBZmQy1jcA9V8bN/yUgHsZ4sIoGB4jEtXMl0oRkydDnqKMnHjQ6KH+4fyELBsS9E308dRIpaoDdRi34sQxqi8PtDU0Rh9rwcV8gQUs5ZSaInsBn84ulSM5JwgfEv6EkOfdSX2/xR0an2VvoKLqjR/45lHCPBj7ZsWK4Hoh0N+V/Dcaes5iOvDhwoTHKOdFAfnpERCrVG0dtHt4qMZG8Y0DMJcGG1IogGbmpjqbyuwfVt44d0Dur4VxoenJi7vWxCTs1IcV6/9nxOTQaxs6Jirvl043jPniyea+2CK2pERiwM2EyFrxHhc2rJyFfylgxp+Q67JVKuGYgegI2ZWwhfC+9/bBf2DTlKOHyHUucrm09ebRSKlKNcXEhNGiRj2yjdU9164wJYRlj4yACRfw5PfM3s2cwdGDITgpTeEagz8sI4uyz2bpu7PS4bR9EVBQBGKuEFavRyTLT/Kw4=
  - secure: B7W9Gbp/IoGAh+L5CQrfuyC4BIqzchRCXO0Fjb5rseQhk1pf5hn16Zk+caSNK01btjaNhHotxP+VXfe/TmTKzkEsW0BvVw/wayl6/MxO1V3XCfQEh9ikpfhy5d1Mw3S9UPubBfkTaHC7SBm2CrkF2unSMF7N0U0PrXwl9pJc81rLOCsFPcIjMPli8/giOcuvxtfb9nv/jCdCU15m3I1SRNzzGYNKM8vDrOmGpADjb0hj/9ltYwg2fjwXgL0sst/LfjW/Vv4H5v+GMMgtHfRFGlEstE58geyqJOSMUTqtHN7HDRF4Bvi0zDIqddtOD0QJ1bXaVxzKtMX39hwbCwTr+EBFT+CkkXyV6ceJM/TlyMDHjflNs4w4fM1rXrHjVoCkhuPX9yw6fkK8RkzL02KQaaxUwC9eMxuPytWlZvNCBG8xnB+X8lSrU47/dzllpprPYOgVnAUkxI0ul4iVSeSaYEegrs44omrYD7Eo4lJcR5Qlh6rnmyH9jXZGKnpgEf4Hwow9KjMCO1EXzYJ2xXS/4i4FQ8Z+Rg0twyqy3IJgzkH8AJkPE95MDypu+hO6kY/QO/ttSUOXr12jzgxDxXL8zxpjDvMoG6BEFc8J6VNWmPMfhFEeAElWZhRfuHYh6eBxLtcMhEz1JbMYbCmdV9/OkXlaSf9So5XuTl5stmvXUBE=
  - secure: LiEtaH6E+q2PNFBjxm4oVCHmXzTWVM+zjVcKp+ixAAz9anIpGEfeeqdY2h0gI/JsBk92on02wYEuob1F0mN8sizC2mSgoSJ7ESgxhdqOUPnbP+bUd+1IOh3M9HW90xDYyLInUYxXaA3Nol4KSd5AmUbgtHHA6Wbad0G1dogNjDtXAklXipOZv6DTVkeL8IFLPt03Gt+219QLQwdZu5CXx3uUDCioGSciQG73FIr069+bDx7UmIyTN8yltxWzmcCIdk5siN24fWkauyqAUGRPz4pXS/Ou7NOd/KBdRnMAs2UoBt0ccni3T9sn8o1BNvb7B/e6QRETHnlYOTK0KePCDKfIV5fbYayyz5+Unr337igWg4YZEOA47+Sp4qAu3V056lCCU2IFte11hHPtHWuwL5ZcfW5VpQX6gGHNdcDAa24AmVhjyI4fLkb1VLPtWgLEyNH8P7heC4IU/vSXSGrIHYSxKsrA1iBivxvtTH2IBHKl84Jllu0o9xtrd5DIYeDbUXAivGftRyq/IiwM0y+Wy1uSKsaEPbWOXx6mwQhZ0SUsjT7BbpS6plIJDrQ+hRAYdhbDlQ+ug1EFDbahxZIzrwa+W4TQk86WP7pbdkMqQBXSjmITcLp2osvV1/5fLJX5fFXOv7X4dFXaTDMYEEukVRJ3JSpeUkNxsY5pPk6qSvY=
  - secure: tRqDUQlOIPyo8bVXbTWXIC6pAQS0ENgL2RVPAFbGT4XpcKzZFjCDmnpDsV2wTdoFcIntN79NQg+BzKNBUh5jlHPd+1fJ49bl+zAuNnFLl+a/Rtrd7I+KTHCJFE3JkcdywH7aHi23QwqcnbwGTxBEYrDmVRc57GyrdZIMD9undQfwwBhQoxTRVqonLqAFVMAaTidOz+sZlZnf9C4icV8ZjTsSAQHv8PpaffvgCsiA/uh75OPjOyaBrzgjTWJ0yN9NX8mUVKAlAKjTa3l2qWpBTXmF8e0buV+vv2ceozc85ccc+Ti7phfb7uYVUa0vnIgr9lHb9nanfISK3AOyF3D4WooVhy3wgeP7U1kPBIzBY9pG77Y29DlGLOjdUknrr1+qsgcOhgHX0+dOKKgyZN4Cp9CyfpPEBSnlOxmZrG0SvJXMeHLV/q7/m0X5DUW8pC2uVd/jPMPb6HdddXspGul9vgfTt89fSPLYz/Z+fQvQYZ/GxNkyTrIs7Sw9QxmJr2bM+45LbQGF8eSqKo7/8niNKOlvZENmd2/BUtMuJA5kL/OjObkur1isc76uWTA0gkWiZqVuBuFjzG3v3UPufSdia1MYFYnBAyYjX71oM+Ou6nxEts1Evkmt5E3HbwzCg+wBr7q0E1DUP/WHaPxA/tMDtUhH3HMnwi9DZswZcrOimY8=
  - secure: ng5RjgN1i2mSo6yy3o45XAIBQB7TKkv3twGWdcxUc1f5/gCO/ac/X4/Jj1Buidc28PBBlfctxIjNAC4/0AlqrHsbULKyU+IT5wMYESUuD5xiqeuSi53qq+UFN117t6CpuAwEOnBkUkh2cFO9ikc/6kPoQvVo7LUieggVugMS5PXlG50UP5IhfaWq+sX03xgOSTmMsZ+On1y3s/HOsf9i63TAoj6vcMgfaWiPz1CQFF3ocSE1Ry4ZgG6Tnl5gmGcXBm+h6gvuQ5MZeGLQAXuqyn1UI7GslgO7Ls3svMiF7LGwa3A/XvWPbMDv/LfTPRBqQ/G5XIPTzHvJX6MzoEzyHSC6fwPx/6UDRndKzEzNkYEODjODNfv51eOvtddYovthxIxS0W3pkJhNv8mFQ6Qqfzn6MVwp97YCsXCosdgP+Uyq5s9eFIe77pdVUhMVXYKpcRWBQLFcQKrDqgfrfSVabSRIM5H5OT7gHdUhoxlkYOngZHsd2cVyKpnNq0GxDBsvxz9CXSo0fnZdJiyPsLmrSrRcoafXOWXg5PzeXZa7thR0ATJW0zZBUYnhfinL7U8TUs19OJ53ApkwhFLCXE7uh+IhiI/lyynYelWZu7Q7IRPnKFRhUEz8lDNwr9jwbL/pzUR/ZAZq5mv27wShvArGwbHnoVmaqxnMdoKmaPoVv5Q=
  - secure: 0kG47OIQiFZOezgqq3XDMdVrDIxJf1e2dNQ7hlu8mCiT0roQlMp9LBmzgqvb0QSL55MGv3qkqDT1uTgeAnhpJzBXSd0BZ0rv6pRkmx8O65qCZ6sSemGTUTXlI4QJ4I2gZAzfXNsGYM29ZodyoVEpeTTEFjbgRf5wG/8qY8s1bg3dlk1k2GTf+BSx0TtiyDcmEXcYvftKof4zje179M5fZtp2ctJ7dTWoRcn9hw1Kh4tRTl7+hgZPveS3HtB+EA/xC55jRSlm0TqQIBYEurGr9GEav7UuGAFcK9Jm1nWDGKbXqU6OwoBBvnuKZcVzB0vOgXGcVqMoHPDAi8RsUFc1PxnrvlI/OvNQEQwVGifarAGzT+STUGic1vOApR8KXXKUUyeZ0t98B65APPI5IWxNqWCadC8GNznq/eTp5WmE/aKU0Ozg0TxOsCFtEHDrcs5FVA7SE3aLl4950O0f7Jb/LC5XrxhOLasWMrFzxA4DqWfkL5jYNEc2xm7tji5nyj+1P55l6vWhtULSgj65zPuClw7fcnFbq+KpGmlNRhGdhoXHOw2GGT86rh03Tlpg+g6WgE1P0ttbKF7mJKiXv5w8PHU5G+1nDpef7txTI3FflBEiqD0ZMLKTS0alO4UQAlN7XxSr2H3RuefVJLWrA4+0kMhfO/2HwmII8LNjbxYkK8o=
  - secure: Y9PakGOLh8A2a/pqJcaece8lNkZeX3xcdV3zZldHUcS61C+AXk5izUGSV+RfIfUopJkyrTee902SMW6PweCGHPml/uuivvATqTCyo/42g9vKWvbyU51qOKj8Dlgm00Gnb0VMrl8qvEluIeoP7dgQjikhxvOrgp0om2C6M6mEqchKNgHR0n4c7npW85VDbScPVE+eieqEYynhHL5SsDkIf75wlcdV/Misjkms03mwKwywv09z1sZvlaVrAKL3d0y5W1Wg7kYjGwPv89gdLAOrNJPiWC0aKxurpI9zUhTNfXt1JStCp66O6GwxUHRLO7Pbh+Os1ATLiQTDqY43/DiHKeSw4cdhS1Bwa/CqL1typke7VJGx65gcl+bdxdlkloZ0aktJUMrrBikdq3ESAMdomFQeEih4QRhsqkwPeXBIMYU5np1S1tf4yvh2HKghzEEXOpO/8F7XAn5iuoRZyJaWVTbYmv033KxlKmGxKPe5nvPQupd3X7wEX3qnCGBavXlt2zdfQOlLkV644XjitlyqMhfGYnnbxLRcUojlHuKaYKZ79/+xHJlxAsucbzmJ07hP0zHsmUykAoFDuS+4e9szYcB37EhbRTS6PjOwEWCz7rMWel14KKntXw7+6sUANe36dA8UOXiADz+BH+jova9jarp2aJ3jP0r74omH2p/1LOQ=
  - VAR_DB_USERNAME: "$VAR_DB_USERNAME"
  - VAR_DB_PASSWORD: "$VAR_DB_PASSWORD"
  - VAR_DB_HOST: "$VAR_DB_HOST"
  - VAR_DB_DATABASE: "$VAR_DB_DATABASE"
  - VAR_ENV: production